<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Day In Their Shoes - Presentation with Audio</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for buttons */
        .interactive-button {
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
        }
        .interactive-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .interactive-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
        }
        /* Style for error messages */
        .error-message {
            color: #dc2626; /* red-600 */
            font-weight: bold;
            padding: 8px;
            border-radius: 8px;
            background-color: #fee2e2; /* red-100 */
            border: 1px solid #ef4444; /* red-500 */
            margin-top: 1rem;
        }
        /* Ensure iframe takes up available space and scrolls if content overflows */
        .pdf-viewer {
            width: 100%;
            height: 400px; /* Default height, will adjust based on controls */
            border: 1px solid #e2e8f0; /* gray-200 */
            border-radius: 0.75rem; /* rounded-xl */
        }
        @media (min-width: 768px) {
            .pdf-viewer {
                height: 500px; /* Larger height on medium screens */
            }
        }
        @media (min-width: 1024px) {
            .pdf-viewer {
                height: 600px; /* Even larger on large screens */
            }
        }
        .file-input-label {
            @apply flex flex-col items-center justify-center cursor-pointer bg-gray-200 hover:bg-gray-300 rounded-md py-2 px-4 text-gray-700 font-semibold transition-colors duration-200;
        }
        .file-input-label input[type="file"] {
            display: none;
        }
        .file-name-display {
            @apply text-sm text-gray-500 mt-1 truncate w-full px-2;
        }
    </style>
</head>
<body class="font-inter bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4">

    <div class="bg-white rounded-xl shadow-lg p-6 w-full max-w-4xl flex flex-col items-center space-y-6">
        <h1 class="text-3xl font-extrabold text-gray-900 mb-4">A Day In Their Shoes</h1>
        <p class="text-gray-600 text-center mb-6">Select your PDF presentation and MP3 audio file.</p>

        <!-- File Input Controls -->
        <div class="w-full grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div class="flex flex-col items-center">
                <label for="pdfFileInput" class="file-input-label interactive-button w-full">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <span>Select PDF File</span>
                    <input type="file" id="pdfFileInput" accept=".pdf">
                </label>
                <div id="pdfFileName" class="file-name-display">No PDF selected</div>
            </div>

            <div class="flex flex-col items-center">
                <label for="audioFileInput" class="file-input-label interactive-button w-full">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <span>Select MP3 File</span>
                    <input type="file" id="audioFileInput" accept=".mp3">
                </label>
                <div id="audioFileName" class="file-name-display">No MP3 selected</div>
            </div>
        </div>

        <!-- PDF Viewer -->
        <div class="w-full flex-grow flex flex-col items-center mt-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-3">Presentation</h2>
            <iframe id="pdfViewer" src="" class="pdf-viewer" frameborder="0">
                Your browser does not support PDFs or a PDF has not been loaded. Please select a PDF file.
            </iframe>
        </div>

        <!-- Audio Player Controls -->
        <div class="w-full max-w-sm flex flex-col items-center space-y-4 pt-6">
            <h2 class="text-xl font-semibold text-gray-700">Audio Narration</h2>
            <!-- Audio element: src will be set by JavaScript based on user selection -->
            <audio id="myAudio" src="" preload="auto" class="w-full"></audio>

            <!-- Play/Pause Button -->
            <button id="playPauseButton" class="interactive-button bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 text-lg" disabled>
                Play Audio
            </button>

            <!-- Display area for messages (e.g., error messages) -->
            <div id="messageBox" class="text-sm text-gray-700 mt-2 text-center w-full"></div>
        </div>
    </div>

    <script>
        // Get references to elements
        const myAudio = document.getElementById('myAudio');
        const playPauseButton = document.getElementById('playPauseButton');
        const messageBox = document.getElementById('messageBox');
        const pdfViewer = document.getElementById('pdfViewer');
        const pdfFileInput = document.getElementById('pdfFileInput');
        const audioFileInput = document.getElementById('audioFileInput');
        const pdfFileNameDisplay = document.getElementById('pdfFileName');
        const audioFileNameDisplay = document.getElementById('audioFileName');

        let isPlaying = false; // Track the current playback state

        // Function to show messages in the message box
        function showMessage(message, type = 'info') {
            messageBox.textContent = message;
            messageBox.classList.remove('error-message'); // Clear previous error styling

            if (type === 'error') {
                messageBox.classList.add('error-message');
            } else {
                messageBox.classList.remove('text-red-600');
                messageBox.classList.add('text-blue-600'); // Default info color
            }
        }

        // Handle PDF file selection
        pdfFileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                if (file.type === 'application/pdf') {
                    const fileURL = URL.createObjectURL(file);
                    pdfViewer.src = fileURL;
                    pdfFileNameDisplay.textContent = `PDF: ${file.name}`;
                    showMessage(`PDF "${file.name}" loaded successfully.`, 'info');
                } else {
                    showMessage('Please select a valid PDF file.', 'error');
                    pdfFileNameDisplay.textContent = 'Invalid file type';
                    pdfViewer.src = ''; // Clear iframe if invalid file
                }
            } else {
                pdfFileNameDisplay.textContent = 'No PDF selected';
                pdfViewer.src = '';
                showMessage('No PDF file selected.', 'info');
            }
        });

        // Handle Audio file selection
        audioFileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                if (file.type === 'audio/mpeg' || file.type === 'audio/mp3') { // Common MP3 MIME types
                    const fileURL = URL.createObjectURL(file);
                    myAudio.src = fileURL;
                    audioFileNameDisplay.textContent = `MP3: ${file.name}`;
                    // Attempt to load metadata to enable play button
                    myAudio.load();
                    showMessage(`MP3 "${file.name}" selected. Loading audio...`, 'info');
                } else {
                    showMessage('Please select a valid MP3 file.', 'error');
                    audioFileNameDisplay.textContent = 'Invalid file type';
                    myAudio.src = ''; // Clear audio if invalid file
                    playPauseButton.disabled = true;
                }
            } else {
                audioFileNameDisplay.textContent = 'No MP3 selected';
                myAudio.src = '';
                playPauseButton.disabled = true;
                showMessage('No MP3 file selected.', 'info');
            }
        });

        // Event listener for the play/pause button
        playPauseButton.addEventListener('click', async () => {
            if (playPauseButton.disabled) {
                showMessage("Cannot play: No valid audio file loaded.", 'error');
                return;
            }
            if (!myAudio.src) {
                showMessage("Cannot play: No audio file has been selected yet.", 'error');
                return;
            }

            try {
                if (isPlaying) {
                    myAudio.pause();
                    playPauseButton.textContent = 'Play Audio';
                    isPlaying = false;
                    showMessage('Audio paused.');
                } else {
                    await myAudio.play();
                    playPauseButton.textContent = 'Pause Audio';
                    isPlaying = true;
                    showMessage('Audio playing...');
                }
            } catch (error) {
                let specificMessage = `Playback failed: ${error.message}.`;
                if (error.name === "NotAllowedError") {
                    specificMessage = "Autoplay prevented. Please click 'Play Audio' to start.";
                } else if (error.name === "AbortError") {
                    specificMessage = "Playback aborted (e.g., by another play request).";
                } else if (error.name === "NotFoundError" || myAudio.networkState === HTMLMediaElement.NETWORK_NO_SOURCE) {
                    specificMessage = `Audio file not found or could not be loaded: ${myAudio.currentSrc}. Please select a valid MP3 file.`;
                }
                showMessage(`Audio Error: ${specificMessage}`, 'error');
                console.error("Audio playback error:", error);
                isPlaying = false;
                playPauseButton.textContent = 'Play Audio';
            }
        });

        // Audio event listeners
        myAudio.addEventListener('play', () => {
            isPlaying = true;
            playPauseButton.textContent = 'Pause Audio';
            showMessage('Audio playing...');
            playPauseButton.disabled = false;
        });

        myAudio.addEventListener('pause', () => {
            isPlaying = false;
            playPauseButton.textContent = 'Play Audio';
            showMessage('Audio paused.');
        });

        myAudio.addEventListener('ended', () => {
            isPlaying = false;
            playPauseButton.textContent = 'Play Audio';
            showMessage('Audio finished.');
        });

        myAudio.addEventListener('loadedmetadata', () => {
            console.log("Audio metadata loaded. Duration:", myAudio.duration);
            showMessage('Audio file loaded. Click "Play Audio" to start.');
            playPauseButton.disabled = false; // Enable play button once metadata is loaded
        });

        myAudio.addEventListener('error', (e) => {
            const error = e.target.error;
            let errorMessage = `An audio error occurred (Code: ${error ? error.code : 'unknown'}).`;
            if (error) {
                switch (error.code) {
                    case MediaError.MEDIA_ERR_ABORTED:
                        errorMessage = 'Audio load aborted by user.';
                        break;
                    case MediaError.MEDIA_ERR_NETWORK:
                        errorMessage = 'A network error prevented audio download.';
                        break;
                    case MediaError.MEDIA_ERR_DECODE:
                        errorMessage = 'The audio could not be decoded. Ensure it\'s a valid MP3 file.';
                        break;
                    case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:
                        errorMessage = `The selected audio format is not supported or the file could not be accessed. Please select a valid MP3.`;
                        break;
                }
            }
            showMessage(`Audio Load Error: ${errorMessage}`, 'error');
            console.error("Audio element error:", error);
            isPlaying = false;
            playPauseButton.textContent = 'Play Audio';
            playPauseButton.disabled = true; // Disable button on error
        });

        // Initial state: disable play button until an audio file is selected and loaded
        window.addEventListener('load', () => {
            playPauseButton.disabled = true;
            showMessage('Please select your PDF and MP3 files to begin.');
        });
    </script>
</body>
</html>
